---
title: "ANOVA Guide"
author: "Matt George"
date: "2022-12-18"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Load packages; if missing, install them
```{r message=FALSE, warning=FALSE}
## clear workspace
rm(list=ls())

## Load Packages; if missing, install them
load.lib<-c("readxl","tidyverse","bestNormalize","agricolae","nlme","multcomp","rstatix") # List of required packages
install.lib <- load.lib[!load.lib %in% installed.packages()] # Select missing packages
for(lib in install.lib) install.packages(lib,dependencies=TRUE) # Install missing packages + dependencies
sapply(load.lib,require,character=TRUE) # Load all packages.

```

```{r}

```




Statistical Testing
```{R}
atpase_plot     <- read_excel("ATPase/ATPase.xlsx",
                              sheet = "stat", col_names = TRUE)
dat_stat <- atpase_plot_all
test_me <- dat_stat$ATPase

dat_stat$ID         <- factor(dat_stat$ID)
dat_stat$trt        <- factor(dat_stat$trt)
dat_stat$ploidy     <- factor(dat_stat$ploidy)
dat_stat$timepoint  <- factor(dat_stat$timepoint)

qqnorm(test_me) # check linearity of transformed data
qqline(test_me)
norm_test <- shapiro.test(test_me) # p-value fail = good, don't need transformation
print(norm_test$p.value)

if(norm_test$p.value<0.05)     {
        normalized <- bestNormalize(test_me)
        test_me <- normalized$x.t # overwrite
        qqnorm(test_me) # check linearity of transformed data
        qqline(test_me)
        print(shapiro.test(test_me))
        print("transformed!",quote=FALSE)}

dat_stat$response <- test_me 

my_test <- aov(response ~ ploidy * timepoint * trt, data = dat_stat)

my_test_summary <- summary(my_test)
summary(my_test)

tx <- with(dat_stat, interaction(timepoint,trt,ploidy))
amod <- aov(response ~ tx, data = dat_stat)
mult_comp <- HSD.test(amod, "tx", group=TRUE, console=TRUE)

write.table(my_test_summary[[1]],                      file = "stats/AOV_atpase.csv",      row.names = TRUE)
write.table(mult_comp$groups,                     file = "stats/HSD_test_atpase.csv", row.names = TRUE)

beep(2)

```